/* 
 * File:   MotorControl.c
 * Author: Jack
 *
 * Created on February 8, 2022, 12:25 AM
 */
//------------------------------------------------------------------------------

#include "MotorControl.h"
#include "tmr2.h"
#include "pwm5.h"

//==============================================================================
//-------------------------------- #DEFINES ------------------------------------
//==============================================================================

// #define MOTORCONTROL_TEST

//==============================================================================
//---------------------------- STATIC VARIABLES --------------------------------
//==============================================================================

uint8_t dutyCyclePercent;
uint16_t dutyCycle10bit;


//==============================================================================
//------------------------------ PUBLIC LIBRARY --------------------------------
//==============================================================================

void MotorControl_Init(void) {
    dutyCyclePercent = 0x00;
    dutyCycle10bit = 0x0000;
    MotorControl_Off();
    return;
}

//------------------------------------------------------------------------------

uint8_t MotorControl_SetIntensity(uint8_t dutyCycle) {
    if ((dutyCycle >= 0) && (dutyCycle <= 100)) {
        dutyCyclePercent = dutyCycle;
        dutyCycle10bit = (dutyCycle*1023)/100;
        PWM5_LoadDutyValue(dutyCycle10bit);
        return SUCCESS;
    }
    else
        return ERROR;
}

//------------------------------------------------------------------------------

void MotorControl_On(void) {
    TMR2_StartTimer();
    return;
}

//------------------------------------------------------------------------------

void MotorControl_Off(void) {
    TMR2_StopTimer();
    TMR2_WriteTimer(0x00);  // clear TMR2 ticks after stopping motor pulse
    return;
}


//==============================================================================
//------------------------- CONDITIONAL TEST HARNESS ---------------------------
//==============================================================================

#ifdef MOTORCONTROL_TEST

int main(void) {
    while(1);
    return 0;
}

#endif

//==============================================================================
//--------------------------------END OF FILE-----------------------------------
//==============================================================================
